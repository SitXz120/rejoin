<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard | Moji</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-white">
  <div class="container py-5">
    <h2 class="text-center mb-4">👤 Dashboard</h2>

    <div class="card bg-secondary p-4 mb-4">
      <h4>🔑 License Key</h4>
      <p id="keyValue" class="text-info fw-bold"></p>

      <h5>💻 Devices (HWID):</h5>
      <ul id="hwidList" class="list-group list-group-flush"></ul>

      <h6 class="mt-3">🎯 Limit Devices:</h6>
      <p id="limitValue" class="fw-bold"></p>

      <button class="btn btn-danger mt-3" onclick="logout()">🚪 Logout</button>
    </div>
  </div>

  <script>
    async function fetchLicenseInfo() {
      const token = localStorage.getItem('token');
      if (!token) return location.href = 'login.html';

      const res = await fetch('/license-info', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ token })
      });

      if (!res.ok) {
        alert("❌ ไม่สามารถโหลดข้อมูล License ได้");
        return logout();
      }

      const data = await res.json();
      document.getElementById('keyValue').innerText = data.key;
      document.getElementById('limitValue').innerText = `${data.hwid.length} / ${data.limit}`;

      const hwidList = document.getElementById('hwidList');
      hwidList.innerHTML = '';
      data.hwid.forEach(h => {
        const li = document.createElement('li');
        li.className = 'list-group-item bg-dark text-white';
        li.innerText = h;
        hwidList.appendChild(li);
      });
    }

    function logout() {
      localStorage.removeItem('token');
      location.href = 'login.html';
    }

    fetchLicenseInfo();
  </script>
</body>
</html>